package club.l4j.currymod.feature.impl.hackimpl.exploit;

import club.l4j.currymod.feature.core.Hack;
import net.minecraft.entity.vehicle.BoatEntity;
import net.minecraft.network.packet.c2s.play.VehicleMoveC2SPacket;
import net.minecraft.util.math.Vec3d;

@Hack.Construct(name = "BoatExecutor", description = "Exploit used in The Convoy Protest (2022)", category = Hack.Category.EXPLOITS)
public class BoatExecutor extends Hack {

    @Override
    public void onEnable() {
        if(!(mc.player.getVehicle() instanceof BoatEntity boat)){
            toggle();
            return;
        }
        Vec3d originalPos = boat.getPos();
        boat.setPosition(originalPos.add(0, 0.05, 0));
        VehicleMoveC2SPacket groundPacket = new VehicleMoveC2SPacket(boat);
        boat.setPosition(originalPos.add(0, 20, 0));
        VehicleMoveC2SPacket skyPacket = new VehicleMoveC2SPacket(boat);
        boat.setPosition(originalPos);
        for (int i = 0; i < 20; i++){
            sendPacket(skyPacket);
            sendPacket(groundPacket);
        }
        sendPacket(new VehicleMoveC2SPacket(boat));
        super.onEnable();
    }
}
